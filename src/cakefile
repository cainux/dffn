{exec} = require "child_process"
fs = require "fs"

task "default", "Default", ->
  invoke "build"
  invoke "minify"

task "build", "Build Project", ->
  exec "coffee --compile --output ./lib/js ./src/coffee/dffn.coffee"

task "minify", "Munge Static Files", ->
  exec "yuicompressor ./lib/js/dffn.js > ./lib/js/dffn.min.js"
  exec "lessc --yui-compress ./src/less/dffn.less > ./lib/css/dffn.min.css"

setLiveUrls = (sourceFile) ->
  fs.readFile sourceFile, "utf8", (error, code) ->
    throw error if error

    outFile = sourceFile.replace /localhost\/dffn/, "dffn.azurewebsites.net"

    fs.writeFile outFile, 